<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coordinate Grid (0,0 bottom-left)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  #grid {
    display: grid;
    gap: 4px;
    margin-top: 10px;
  }
  .cell {
    border: 1px solid #888;
    text-align: center;
    padding: 10px;
    font-weight: bold;
    transition: background-color 0.3s;
  }
  .red { color: red; }
  .blue { color: blue; }
  .highlight {
    background-color: yellow;
  }
  .start {
    background-color: lightgreen;
  }
  input {
    margin-right: 10px;
  }
  #loopList {
    margin-top: 20px;
    font-family: monospace;
    white-space: pre-wrap;
  }
</style>
</head>
<body>
<h2>n × m Coordinate Grid (0,0 bottom-left → n×m−1, n×m−1 top-right)</h2>

<label>n (width): <input type="number" id="n" min="1" value="5"></label>
<label>m (height): <input type="number" id="m" min="1" value="7"></label>
<button onclick="makeGrid()">Make Grid</button>

<div id="grid"></div>

<hr>

<label>Enter red number: <input type="number" id="redNumber" min="0"></label>
<button onclick="findAndHighlightLoop()">Find Loop</button>

<p><strong>Loop Result:</strong> <span id="loopResult"></span></p>

<hr>

<h3>All Loop Sizes</h3>
<div id="loopList"></div>

<script>
let n = 0, m = 0;

function makeGrid() {
  n = parseInt(document.getElementById('n').value);
  m = parseInt(document.getElementById('m').value);
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  grid.style.gridTemplateColumns = `repeat(${n}, 1fr)`;

  const total = n * m;

  // Build grid visually (top row first)
  for (let y = m - 1; y >= 0; y--) {
    for (let x = 0; x < n; x++) {
      const red = y * n + x;  // horizontal order (bottom→top)
      const blue = x * m + y; // vertical order (bottom→top)
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.red = red;
      cell.dataset.blue = blue;
      cell.innerHTML = `(<span class="red">${red}</span>,<span class="blue">${blue}</span>)`;
      grid.appendChild(cell);
    }
  }

  // Update input range
  document.getElementById('redNumber').max = total - 1;

  // Compute and list all loops
  listAllLoops();
}

function findLoop(startRed) {
  const total = n * m;
  if (isNaN(startRed) || startRed < 0 || startRed >= total) return [];

  let loop = [];
  let currentRed = startRed;
  const visited = new Set();

  while (!visited.has(currentRed)) {
    visited.add(currentRed);
    loop.push(currentRed);

    // Find the cell whose blue number = currentRed
    const cell = Array.from(document.querySelectorAll('.cell'))
      .find(c => parseInt(c.dataset.blue) === currentRed);
    if (!cell) break;

    const nextRed = parseInt(cell.dataset.red);
    currentRed = nextRed;

    if (visited.has(currentRed)) {
      loop.push(currentRed);
      break;
    }
  }

  return loop;
}

function listAllLoops() {
  const total = n * m;
  const seen = new Set();
  const results = [];

  for (let i = 0; i < total; i++) {
    if (seen.has(i)) continue;
    const loop = findLoop(i);
    const size = loop.length > 1 ? loop.length - 1 : 0;
    results.push(`${loop.join(' → ')} (Loop size: ${size})`);
    loop.forEach(num => seen.add(num));
  }

  const uniqueLoops = results.length;
  const output = results.join('\n') + `\n\nTotal unique loops: ${uniqueLoops}`;
  document.getElementById('loopList').textContent = output;
}

function highlightLoop(loop) {
  // Clear highlights
  document.querySelectorAll('.cell').forEach(c => c.classList.remove('highlight', 'start'));
  loop.forEach((num, i) => {
    const cell = Array.from(document.querySelectorAll('.cell'))
      .find(c => parseInt(c.dataset.red) === num);
    if (cell) {
      if (i === 0) cell.classList.add('start');
      else cell.classList.add('highlight');
    }
  });
}

function findAndHighlightLoop() {
  const redNum = parseInt(document.getElementById('redNumber').value);
  if (!n || !m) {
    alert('Please create a grid first.');
    return;
  }
  const total = n * m;
  if (isNaN(redNum) || redNum < 0 || redNum >= total) {
    alert(`Red number must be between 0 and ${total - 1}`);
    return;
  }

  const loop = findLoop(redNum);
  const size = loop.length > 1 ? loop.length - 1 : 0;

  document.getElementById('loopResult').textContent =
    `${loop.join(' → ')} (Loop size: ${size})`;

  highlightLoop(loop);
}
</script>
</body>
</html>
